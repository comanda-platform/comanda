@{
    var status = BatchState?.Status ?? CookingStatus.NotStarted;
    var cardColor = GetCardColor(status);
}

<MudCard Elevation="2" Style="@($"border-left: 4px solid {cardColor};")">
    <MudCardHeader>
        <CardHeaderContent>
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudText Typo="Typo.h6">@(MenuItem.OverriddenName ?? MenuItem.ProductName)</MudText>
                <StatusBadge CookingStatus="@status" />
            </MudStack>
        </CardHeaderContent>
    </MudCardHeader>

    <MudCardContent>
        <MudStack Spacing="2">
            @if (BatchState?.Status == CookingStatus.InProgress && BatchState.StartedAt.HasValue)
            {
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                    <MudIcon Icon="@Icons.Material.Filled.Timer" Size="Size.Small" Color="Color.Warning" />
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Cooking for:</MudText>
                    <ElapsedTimer StartTime="@BatchState.StartedAt.Value" />
                </MudStack>
            }

            @if (BatchState?.Status == CookingStatus.Completed && BatchState.Yield.HasValue)
            {
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                    <MudIcon Icon="@Icons.Material.Filled.Restaurant" Size="Size.Small" Color="Color.Success" />
                    <MudText Typo="Typo.body2">
                        <strong>@BatchState.Yield</strong> portions ready
                    </MudText>
                </MudStack>

                @if (BatchState.CompletedAt.HasValue)
                {
                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        Completed at @BatchState.CompletedAt.Value.ToString("h:mm tt")
                    </MudText>
                }
            }

            @if (BatchState?.Status == CookingStatus.NotStarted)
            {
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Ready to cook
                </MudText>
            }
        </MudStack>
    </MudCardContent>

    <MudCardActions>
        <MudStack Row="true" Spacing="1" Style="width: 100%;">
            @switch (status)
            {
                case CookingStatus.NotStarted:
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Warning"
                               StartIcon="@Icons.Material.Filled.LocalFireDepartment"
                               OnClick="@(() => OnStartCooking.InvokeAsync(MenuItem.ProductPublicId))"
                               FullWidth="true">
                        Start Cooking
                    </MudButton>
                    break;

                case CookingStatus.InProgress:
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Success"
                               StartIcon="@Icons.Material.Filled.CheckCircle"
                               OnClick="@(() => OnCompleteCooking.InvokeAsync(MenuItem.ProductPublicId))"
                               FullWidth="true">
                        Mark Ready
                    </MudButton>
                    break;

                case CookingStatus.Completed:
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Secondary"
                               StartIcon="@Icons.Material.Filled.Refresh"
                               OnClick="@(() => OnResetBatch.InvokeAsync(MenuItem.ProductPublicId))"
                               Size="Size.Small">
                        Reset
                    </MudButton>
                    break;
            }

            <MudIconButton Icon="@Icons.Material.Filled.MenuBook"
                           Color="Color.Primary"
                           OnClick="@(() => OnViewRecipe.InvokeAsync(MenuItem.ProductPublicId))"
                           Title="View Recipe" />
        </MudStack>
    </MudCardActions>
</MudCard>

@code {
    [Parameter, EditorRequired] public DailyMenuItemResponse MenuItem { get; set; } = default!;
    [Parameter] public BatchState? BatchState { get; set; }
    [Parameter] public EventCallback<string> OnStartCooking { get; set; }
    [Parameter] public EventCallback<string> OnCompleteCooking { get; set; }
    [Parameter] public EventCallback<string> OnResetBatch { get; set; }
    [Parameter] public EventCallback<string> OnViewRecipe { get; set; }

    private string GetCardColor(CookingStatus status)
    {
        return status switch
        {
            CookingStatus.NotStarted => "var(--mud-palette-text-secondary)",
            CookingStatus.InProgress => "var(--mud-palette-warning)",
            CookingStatus.Completed => "var(--mud-palette-success)",
            _ => "var(--mud-palette-text-secondary)"
        };
    }
}







